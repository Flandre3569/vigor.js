# SSG架构

## CRS

客户端渲染（crs），是指在browser在生成页面时，向客户端所在的服务器进行请求（nginx），然后客户端服务器将通过Javascript动态加载，最后形成一个单页面应用（SPA）。

SPA默认只返回一个空的HTML页面，在切换页面的时候实际上只是切换的前端路由而不是再请求一个新的页面。

### 优点：

- 1.只需要加载一次，所以速度会比传统的web应用程序更快。
- 2.更好的用户体验。切换页面只需要内容发生变化，页面并没有重新加载，从而使体验变得更流畅。
- 3.可以更轻松地构建功能丰富的web应用程序。

### 缺点：

- 1.SPA应用默认只返回一个空的HTML页面，不利于SEO（search engine optimization）
- 2.首屏加载的资源过大时，一样会影响首屏的渲染速度。
- 3.不利于构建复杂的项目，复杂的Web应用程序的大文件可能会变得难以维护。

## 服务器端渲染（SSR）

SSR → Server Side Render

在服务端渲染页面，并将渲染好的HTML返回给浏览器呈现。

**水合（hydration）：**

把客户端项目用webpack打包成一个js脚本，然后通过这个脚本对应用程序进行激活，激活后静态页面就可以进行交互了，也就区别于SSG的静态站点作为动态站点进行交互操作了。

SSR应用也称为同构应用。

构建SSR的常见库和框架有：Vue Nuxt 和 React Next.js

![ssrArch](http://mingxuan3569.oss-cn-beijing.aliyuncs.com/image/ssrArch.png)

### 优点：

- 1.更快的首屏渲染速度
- 2.更好的SEO
- 3.SSR应用程序在Hydration之后依然可以保留Web应用程序的交互性，比如：前端路由、响应式数据和虚拟DOM等。

### 缺点：

SSR通常需要对服务器进行更多的API调用，以及在服务器渲染需要消耗更多的服务器资源，成本高。

增加了一定的开发成本，用户需要关心哪些代码是运行在服务器端，哪些代码是运行在浏览器端。

SSR配置站点的缓存通常会比SPA站点要复杂。

## 静态站点生成（SSG）

SSG → static site generate

预先生成好的静态网站。

### 优点：

- 1.访问速度非常快。
- 2.直接给浏览器返回静态HTML，也有利于SEO
- 3.SSG应用依然保留了SPA应用的特性，比如：前端路由、响应式数据、虚拟DOM等。

### 缺点：

页面都是静态的，不利于展示实时性的内容，实时性的更适合SSR。

如果站点内容更新了，那必须重新再次构建和部署。

## 跨请求状态污染

在SPA中，遵循单例模式，也就是只能存在一个实例，每个用户在使用浏览器访问访问SPA应用时，应用模块都会重新初始化。

然而在SSR模式下，App应用模块通常只会初始化一次，同一个应用模块会在多个服务器请求之间被复用，而我们的单例状态状态对象也会在多个请求中被复用，比如当一个用户对一个共享的单例状态进行修改时，有可能会将这个状态意外的泄露给另一个正在使用的用户。

这种现象称之为 — 跨请求状态污染。

为解决这个问题，也就是使用函数创建多个实例，然后将实例分别处理，所以SSR模式的压力集中在服务端，因为如果项目很大的时候，实例也会相应的变得很多，服务端处理的压力就会变大。

```js
let app = createSSRApp();
```

后期在使用路由或者使用Store时也是一样的道理。